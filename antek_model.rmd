---
title: "Antek"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}

rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)

#library(vars)
```

## Intro

This documents the fforts to create a better model than eq3 - so bogie corner acc as a function of wheel acc 

```{r data in, echo = FALSE}

# reading in data
data_train <- readRDS("./input/train_data.RDS")

data_test  <- readRDS("./input/test_data.RDS")

#linear models:
source("./R Scripts/linear_models.R")

```

## Models

### eq3

kept here for reference - as it might be the best thing so far
  
```{r eq3, echo = FALSE}

source("./R Scripts/models_eq3.R")

res3<-run_fits(model_df = models, data_df = data_train)

res3$Track<-ifelse(res3$ExperimentID<101,1,2)

res3_test<-run_fits(model_df = models, data_df = data_test)

res3_test$Track<- ifelse (res3_test$ExperimentID<101,1,2)

```

### test set flags - based on eq3 and normal distribution

```{r flags eq3, echo = FALSE}

summary_res_3<-summarize(group_by(res3,Track,Speed,freq,model),avg=mean(c2),st_dev=sd(c2))

res3_test_flags<-merge(res3_test,summary_res_3,by=c("Track","Speed","freq","model"),all.x=TRUE)

res3_test_flags$pdb_up<-pnorm(res3_test_flags$c2,
                              mean = res3_test_flags$avg,
                              sd = res3_test_flags$st_dev,
                              lower.tail = FALSE)


res3_test_flags$pdb<-pnorm(res3_test_flags$c2,
                              mean = res3_test_flags$avg,
                              sd = res3_test_flags$st_dev)

sum_pdb<- summarize(group_by(res3_test_flags,ExperimentID,modeled_element),
                    max_pdb=max(pdb_up),
                    count_up_50=sum(pdb_up>0.5),
                    count_pdb_50=sum(pdb>.50))

sum_pdb_id<- summarize(group_by(res3_test_flags,ExperimentID),
                    max_pdb=max(pdb_up),
                    count_up_50=sum(pdb_up>0.5),
                    count_pdb_50=sum(pdb>.50))


```

### eq3 + platform

platform added as source of excitation for bogie acc

```{r eq with platform, echo = FALSE}



```

### vector model

considering a VAR model with wheels as exogenous variables and platform and bogie as endogenous ones

```{r var, echo = FALSE}


```

## Comparison plots

